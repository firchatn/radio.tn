var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var radios = [{
    title: "Mosaique FM",
    src: "http://radio.mosaiquefm.net:8000/mosalive",
    img: "./imgs/mosaiquefm.png",
    url: "https://www.mosaiquefm.net/"
}, {
    title: "Diwan FM",
    src: "http://stream8.tanitweb.com/diwanfm",
    img: "./imgs/diwanfm.png",
    url: "http://www.diwanfm.net/"
}, {
    title: "Shems FM",
    src: "http://stream6.tanitweb.com/shems",
    img: "./imgs/shemsfm.png",
    url: "http://shemsfm.net:8080/"
}, {
    title: "Jawhara FM",
    src: "http://streaming2.toutech.net:8000/jawharafm",
    img: "./imgs/jawharafm.png",
    url: "http://www.jawharafm.net/"
}, {
    title: "Zitouna FM",
    src: "http://stream8.tanitweb.com/zitounafm",
    img: "./imgs/zitounafm.png",
    url: "http://www.zitounafm.net/"
}, {
    title: "Express FM",
    src: "http://expressfm.ice.infomaniak.ch/expressfm-64.mp3",
    img: "./imgs/radioexpressfm.png",
    url: "http://www.radioexpressfm.com/"
}, {
    title: "Oxygene FM",
    src: "http://radiooxygenefm.ice.infomaniak.ch/radiooxygenefm-64.mp3",
    img: "./imgs/radiooxygene.png",
    url: "http://www.radiooxygene.tn/"
}, {
    title: "Knooz FM",
    src: "http://streaming.knoozfm.net:8000/knoozfm",
    img: "./imgs/knoozfm.png",
    url: "http://www.knoozfm.net/"
}, {
    title: "Cap FM",
    src: "http://stream8.tanitweb.com/capfm",
    img: "./imgs/capradio.png",
    url: "http://www.capradio.tn/"
}, {
    title: "I FM",
    src: "http://5.135.138.182:8000/direct",
    img: "./imgs/ifm.png",
    url: "https://www.ifm.tn/"
}, {
    title: "Sabra FM",
    src: "http://stream6.tanitweb.com/sabrafm",
    img: "./imgs/radiosabrafm.png",
    url: "http://www.radiosabrafm.net/"
}, {
    title: "Misk FM",
    src: "http://178.32.253.134:8000/stream?type=.mp3",
    img: "./imgs/miskfm.png",
    url: "http://misk.fm/"
}, {
    title: "Radio Med",
    src: "http://stream6.tanitweb.com/radiomed",
    img: "./imgs/radiomedtunisie.png",
    url: "http://radiomedtunisie.com/"
}, {
    title: "Oasis FM",
    src: "http://stream6.tanitweb.com/oasis",
    img: "./imgs/oasisfm.png",
    url: "http://www.oasisfm.tn/"
}, {
    title: "Ulysse FM",
    src: "http://188.165.79.152:9990/;stream.mp3",
    img: "./imgs/ulysse-fm.png",
    url: "http://www.ulysse-fm.net/"
}, {
    title: "Saraha FM",
    src: "http://ns326208.ip-37-59-9.eu:8000/sarahafm",
    img: "./imgs/sarahafm.png",
    url: "http://sarahafm.tn/"
}, {
    title: "MFM FM",
    src: "http://92.222.225.69:9300/;",
    img: "./imgs/radiomfm.png",
    url: "http://www.radiomfm.tn/"
}, {
    title: "Nejma FM",
    src: "http://188.166.109.186:8000/stream",
    img: "./imgs/nejmafm.png",
    url: "http://nejmafm.com/"
}, {
    title: "Radio 6",
    src: "http://streaming.radio6tunis.net:8000/radio6tunis",
    img: "./imgs/radio6tunis.png",
    url: "http://www.radio6tunis.net/"
}];

var App = function () {
    function App() {
        _classCallCheck(this, App);

        this.initAudio();
        this.initUI();
        this.initPlaylist();
    }

    _createClass(App, [{
        key: "initUI",
        value: function initUI() {
            var _this = this;

            this.controls = {
                prev: document.querySelector("#btn-prev"),
                next: document.querySelector("#btn-next"),
                play: document.querySelector("#btn-play"),
                volume: document.querySelector("#btn-volume")
            };
            this.controls.prev.onclick = function () {
                _this.currentSong = _this.currentSong > 0 ? _this.currentSong - 1 : radios.length - 1;
                _this.loadAudio();
            };
            this.controls.next.onclick = function () {
                _this.currentSong = _this.currentSong < radios.length - 1 ? _this.currentSong + 1 : 0;
                _this.loadAudio();
            };
            this.controls.play.onclick = function () {
                var i = _this.controls.play.getElementsByTagName("i")[0];
                if (_this.playing && _this.audioReady) {
                    i.classList.remove("fa-pause");
                    i.classList.add("fa-play");
                    _this.playing = false;
                    _this.audio.pause();
                } else if (!_this.playing && _this.audioReady) {
                    i.classList.remove("fa-play");
                    i.classList.add("fa-pause");
                    _this.playing = true;
                    _this.audio.play();
                } else if (_this.audioReady === undefined) {
                    _this.loadAudio();
                }
            };
            this.controls.volume.onclick = function () {
                var i = _this.controls.volume.getElementsByTagName("i")[0];
                _this.volume = _this.volume > 0 ? _this.volume - 0.5 : 1;
                switch (_this.volume) {
                    case 1:
                        i.classList.remove("fa-volume-off");
                        i.classList.add("fa-volume-up");
                        break;
                    case 0.5:
                        i.classList.remove("fa-volume-up");
                        i.classList.add("fa-volume-down");
                        break;
                    case 0:
                        i.classList.remove("fa-volume-down");
                        i.classList.add("fa-volume-off");
                        break;
                    default:
                        break;
                }
                _this.gainNode.gain.value = _this.volume;
            };
            this.background = document.getElementById("background");
            this.title = document.getElementById("title");
            this.playlist = document.getElementById("playlist");
            this.playlist.onclick = function (e) {
                if (!e.target.dataset.idx) {
                    return;
                }
                _this.currentSong = parseInt(e.target.dataset.idx);
                _this.loadAudio();
            };
            this.background.classList.remove("loading");
        }
    }, {
        key: "initPlaylist",
        value: function initPlaylist() {
            var idx = 0;
            var _iteratorNormalCompletion = true;
            var _didIteratorError = false;
            var _iteratorError = undefined;

            try {
                for (var _iterator = radios[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                    var radio = _step.value;

                    var item = document.createElement("li");
                    var img = document.createElement("img");
                    img.src = radio.img;
                    img.dataset.idx = idx;
                    item.dataset.idx = idx;
                    item.appendChild(img);
                    this.playlist.appendChild(item);
                    idx++;
                }
            } catch (err) {
                _didIteratorError = true;
                _iteratorError = err;
            } finally {
                try {
                    if (!_iteratorNormalCompletion && _iterator.return) {
                        _iterator.return();
                    }
                } finally {
                    if (_didIteratorError) {
                        throw _iteratorError;
                    }
                }
            }
        }
    }, {
        key: "initAudio",
        value: function initAudio() {
            this.currentSong = 0;
            this.volume = 1;

            this.audio = document.getElementById("audio");
        }
    }, {
        key: "loadAudio",
        value: function loadAudio() {
            var _this2 = this;

            this.audioReady = false;
            this.playing = false;
            this.background.classList.add("loading");

            this.controls.prev.classList.add("disabled");
            this.controls.next.classList.add("disabled");
            this.controls.play.classList.add("disabled");

            this.audio.src = radios[this.currentSong].src;
            this.audio.load();
            this.audio.oncanplay = function () {
                _this2.audio.oncanplay = undefined;
                _this2.playAudio();
            };
        }
    }, {
        key: "playAudio",
        value: function playAudio() {
            this.audioReady = true;
            this.playing = true;

            this.background.classList.remove("loading");
            this.title.innerHTML = radios[this.currentSong].title;

            this.controls.prev.classList.remove("disabled");
            this.controls.next.classList.remove("disabled");
            this.controls.play.classList.remove("disabled");

            this.controls.play.getElementsByTagName("i")[0].classList.remove("fa-play");
            this.controls.play.getElementsByTagName("i")[0].classList.add("fa-pause");

            this.audio.play();
        }
    }]);

    return App;
}();

window.onload = function () {
    var app = new App();
};

